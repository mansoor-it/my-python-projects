# إصلاح مشكلة تضارب الصور

## المشكلة
كانت هناك مشكلة في النظام حيث أن صور المنتجات والمتاجر كانت تُحفظ في نفس المجلد، مما يؤدي إلى:
- تضارب في أسماء الملفات
- استبدال الصور ببعضها البعض
- فقدان الصور عند رفع صور جديدة

## الحل المطبق

### 1. إنشاء مجلدات منفصلة
تم إنشاء مجلدات منفصلة للصور:
- `static/uploads/products/` - لصور المنتجات
- `static/uploads/stores/` - لصور المتاجر
- `static/uploads/` - للملفات العامة (البحث بالصورة)

### 2. نظام تسمية فريد
تم تطوير نظام تسمية فريد للملفات:
- `product_[timestamp]_[unique_id].[extension]` للمنتجات
- `store_[timestamp]_[unique_id].[extension]` للمتاجر

### 3. دالة مساعدة للصور
تم إضافة دالة `get_image_url()` لتحديد المسار الصحيح للصور:
```python
get_image_url(image_filename, content_type="product")
```

### 4. نقل الصور القديمة
تم إضافة دالة `migrate_old_images()` لنقل الصور الموجودة إلى المجلدات الجديدة.

## كيفية الاستخدام في القوالب

### عرض صورة منتج:
```html
<img src="{{ get_image_url(product.image, 'product') }}" alt="{{ product.name }}">
```

### عرض صورة متجر:
```html
<img src="{{ get_image_url(store.image, 'store') }}" alt="{{ store.name }}">
```

## الفوائد
1. **عدم تضارب الصور**: كل نوع له مجلده الخاص
2. **أسماء فريدة**: لا يمكن استبدال الصور
3. **تنظيم أفضل**: فصل واضح بين أنواع الصور
4. **سهولة الصيانة**: يمكن حذف أو نقل مجلد معين بسهولة

## ملاحظات مهمة
- تم نقل الصور القديمة تلقائياً عند تشغيل التطبيق
- الصور الجديدة ستُحفظ في المجلدات المخصصة
- القوالب تحتاج إلى تحديث لاستخدام الدالة الجديدة 